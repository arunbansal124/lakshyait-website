<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Family Video Call</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            overflow: hidden;
        }
        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .mirror {
            transform: scaleX(-1);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .shadow-premium {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        input:focus {
            outline: none;
        }
        button {
            transition: all 0.2s ease;
        }
        button:active {
            transform: scale(0.95);
        }
        .notification-badge {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        // Simple state management
        let state = {
            currentUser: null,
            showLogin: true,
            showRegister: false,
            inCall: false,
            videoEnabled: true,
            audioEnabled: true,
            pendingUsers: [],
            approvedUsers: [{ email: 'lakshyabansal1204@gmail.com', password: 'Bansal@1204', name: 'Lakshya Bansal', role: 'admin' }],
            activeUsers: [],
            localStream: null,
            error: ''
        };

        // Storage functions
        async function loadData() {
            const admin = { email: 'lakshyabansal1204@gmail.com', password: 'Bansal@1204', name: 'Lakshya Bansal', role: 'admin' };
            
            try {
                const usersData = localStorage.getItem('approved-users');
                if (usersData) {
                    const savedUsers = JSON.parse(usersData);
                    // Always ensure admin exists
                    if (!savedUsers.some(u => u.email === admin.email)) {
                        savedUsers.push(admin);
                    }
                    state.approvedUsers = savedUsers;
                    localStorage.setItem('approved-users', JSON.stringify(savedUsers));
                } else {
                    state.approvedUsers = [admin];
                    localStorage.setItem('approved-users', JSON.stringify([admin]));
                }
                
                const pendingData = localStorage.getItem('pending-users');
                if (pendingData) {
                    state.pendingUsers = JSON.parse(pendingData);
                }
            } catch (err) {
                state.approvedUsers = [admin];
                localStorage.setItem('approved-users', JSON.stringify([admin]));
            }
            render();
        }

        // Auth functions
        function handleLogin() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = state.approvedUsers.find(u => u.email === email && u.password === password);
            if (user) {
                state.currentUser = user;
                state.showLogin = false;
                state.error = '';
                state.activeUsers.push({ ...user, joinedAt: Date.now() });
                render();
            } else {
                state.error = 'Invalid credentials';
                render();
            }
        }

        function handleRegister() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            if (state.approvedUsers.some(u => u.email === email) || state.pendingUsers.some(u => u.email === email)) {
                state.error = 'Email already exists';
                render();
                return;
            }
            
            const newUser = { name, email, password, role: 'user', requestedAt: Date.now() };
            state.pendingUsers.push(newUser);
            localStorage.setItem('pending-users', JSON.stringify(state.pendingUsers));
            
            alert('Registration submitted! Please wait for admin approval.');
            state.showRegister = false;
            state.error = '';
            render();
        }

        function approveUser(userEmail) {
            const user = state.pendingUsers.find(u => u.email === userEmail);
            state.pendingUsers = state.pendingUsers.filter(u => u.email !== userEmail);
            state.approvedUsers.push({ ...user, approvedAt: Date.now() });
            
            localStorage.setItem('pending-users', JSON.stringify(state.pendingUsers));
            localStorage.setItem('approved-users', JSON.stringify(state.approvedUsers));
            render();
        }

        function rejectUser(userEmail) {
            state.pendingUsers = state.pendingUsers.filter(u => u.email !== userEmail);
            localStorage.setItem('pending-users', JSON.stringify(state.pendingUsers));
            render();
        }

        function handleLogout() {
            if (state.inCall) endCall();
            state.currentUser = null;
            state.showLogin = true;
            state.activeUsers = state.activeUsers.filter(u => u.email !== state.currentUser?.email);
            render();
        }

        // Video call functions
        async function startCall() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' }, 
                    audio: true 
                });
                state.localStream = stream;
                state.inCall = true;
                render();
                
                setTimeout(() => {
                    const video = document.getElementById('localVideo');
                    if (video) video.srcObject = stream;
                }, 100);
            } catch (err) {
                alert('Could not access camera/microphone. Please grant permissions.');
            }
        }

        function endCall() {
            if (state.localStream) {
                state.localStream.getTracks().forEach(track => track.stop());
                state.localStream = null;
            }
            state.inCall = false;
            render();
        }

        function toggleVideo() {
            if (state.localStream) {
                const videoTrack = state.localStream.getVideoTracks()[0];
                if (videoTrack) {
                    videoTrack.enabled = !videoTrack.enabled;
                    state.videoEnabled = videoTrack.enabled;
                    render();
                }
            }
        }

        function toggleAudio() {
            if (state.localStream) {
                const audioTrack = state.localStream.getAudioTracks()[0];
                if (audioTrack) {
                    audioTrack.enabled = !audioTrack.enabled;
                    state.audioEnabled = audioTrack.enabled;
                    render();
                }
            }
        }

        // Render function
        function render() {
            const app = document.getElementById('app');
            const wasInCall = state.inCall;
            const videoElement = wasInCall ? document.getElementById('localVideo') : null;
            const currentStream = state.localStream;
            
            if (state.showLogin) {
                app.innerHTML = `
                    <div class="min-h-screen gradient-bg flex items-center justify-center p-4">
                        <div class="glass-effect rounded-3xl shadow-premium p-6 sm:p-8 w-full max-w-md slide-in">
                            <div class="text-center mb-6 sm:mb-8">
                                <div class="inline-flex items-center justify-center w-16 h-16 bg-white rounded-2xl shadow-lg mb-4">
                                    <svg class="w-10 h-10 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-2">
                                    Family Connect
                                </h1>
                                <p class="text-gray-600 text-sm">Stay close, no matter the distance</p>
                            </div>
                            
                            ${!state.showRegister ? `
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input
                                            type="email"
                                            id="loginEmail"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base"
                                            placeholder="Enter your email"
                                        />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                        <input
                                            type="password"
                                            id="loginPassword"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base"
                                            placeholder="Enter your password"
                                        />
                                    </div>
                                    ${state.error ? `<p class="text-red-500 text-sm">${state.error}</p>` : ''}
                                    <button
                                        onclick="handleLogin()"
                                        class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-xl hover:from-purple-700 hover:to-blue-700 transition text-base font-semibold shadow-lg"
                                    >
                                        Sign In
                                    </button>
                                    <button
                                        onclick="state.showRegister = true; state.error = ''; render();"
                                        class="w-full text-purple-600 py-2 hover:bg-purple-50 rounded-lg transition text-base font-medium"
                                    >
                                        New user? Register here
                                    </button>
                                    <p class="text-xs text-gray-500 mt-4 text-center bg-gray-50 rounded-lg py-2 px-3">
                                        Admin credentials updated
                                    </p>
                                </div>
                            ` : `
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                                        <input
                                            type="text"
                                            id="regName"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base"
                                            placeholder="Your full name"
                                        />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                        <input
                                            type="email"
                                            id="regEmail"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base"
                                            placeholder="Your email"
                                        />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                                        <input
                                            type="password"
                                            id="regPassword"
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-base"
                                            placeholder="Create a password"
                                        />
                                    </div>
                                    ${state.error ? `<p class="text-red-500 text-sm">${state.error}</p>` : ''}
                                    <button
                                        onclick="handleRegister()"
                                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-3 rounded-xl hover:from-green-700 hover:to-emerald-700 transition text-base font-semibold shadow-lg"
                                    >
                                        Request Access
                                    </button>
                                    <button
                                        onclick="state.showRegister = false; state.error = ''; render();"
                                        class="w-full text-purple-600 py-2 hover:bg-purple-50 rounded-lg transition text-base font-medium"
                                    >
                                        Back to Login
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                `;
            } else {
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                        <!-- Header -->
                        <div class="glass-effect shadow-lg border-b border-gray-200 sticky top-0 z-10">
                            <div class="px-4 py-4 flex items-center justify-between max-w-7xl mx-auto">
                                <div class="flex items-center gap-3">
                                    <div class="bg-gradient-to-br from-purple-600 to-blue-600 p-2 rounded-xl shadow-md">
                                        <svg class="w-6 h-6 sm:w-7 sm:h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h1 class="text-lg sm:text-xl font-bold text-gray-800">Family Connect</h1>
                                        <p class="text-xs text-gray-600">ðŸ‘‹ ${state.currentUser.name}</p>
                                    </div>
                                </div>
                                ${state.currentUser?.role === 'admin' && state.pendingUsers.length > 0 ? `
                                    <div class="flex items-center gap-2">
                                        <span class="hidden sm:inline bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full notification-badge">
                                            ${state.pendingUsers.length} new
                                        </span>
                                        <button
                                            onclick="handleLogout()"
                                            class="flex items-center gap-1 px-3 py-2 text-red-600 hover:bg-red-50 rounded-xl transition text-sm font-medium"
                                        >
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                            </svg>
                                            <span class="hidden sm:inline">Logout</span>
                                        </button>
                                    </div>
                                ` : `
                                    <button
                                        onclick="handleLogout()"
                                        class="flex items-center gap-1 px-3 py-2 text-red-600 hover:bg-red-50 rounded-xl transition text-sm font-medium"
                                    >
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                                        </svg>
                                        <span class="hidden sm:inline">Logout</span>
                                    </button>
                                `}
                            </div>
                        </div>

                        <div class="p-4 space-y-4 max-w-7xl mx-auto">
                            <!-- Video Call Area -->
                            <div class="bg-white rounded-2xl shadow-xl overflow-hidden slide-in">
                                ${!state.inCall ? `
                                    <div class="video-container flex items-center justify-center">
                                        <div class="text-center z-10 relative">
                                            <button
                                                onclick="startCall()"
                                                class="bg-white text-purple-600 px-8 py-4 rounded-2xl hover:shadow-2xl transition-all text-lg font-bold flex items-center gap-3 shadow-xl hover:scale-105 mx-auto"
                                            >
                                                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                                </svg>
                                                Start Video Call
                                            </button>
                                            <p class="text-white mt-4 text-sm opacity-90">Ready when you are!</p>
                                        </div>
                                    </div>
                                ` : `
                                    <div class="video-container">
                                        <video id="localVideo" autoplay playsinline muted class="mirror"></video>
                                        <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex gap-2 sm:gap-3">
                                            <button
                                                onclick="toggleVideo()"
                                                class="p-3 sm:p-4 rounded-full ${state.videoEnabled ? 'bg-gray-700 hover:bg-gray-600' : 'bg-red-600 hover:bg-red-700'} transition"
                                            >
                                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    ${state.videoEnabled ? 
                                                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />' :
                                                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-8-5l.621.621a1 1 0 001.06.22l2.598-1.299a1 1 0 00.22-1.06L11.878 8M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />'
                                                    }
                                                </svg>
                                            </button>
                                            <button
                                                onclick="toggleAudio()"
                                                class="p-3 sm:p-4 rounded-full ${state.audioEnabled ? 'bg-gray-700 hover:bg-gray-600' : 'bg-red-600 hover:bg-red-700'} transition"
                                            >
                                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    ${state.audioEnabled ?
                                                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" />' :
                                                        '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />'
                                                    }
                                                </svg>
                                            </button>
                                            <button
                                                onclick="endCall()"
                                                class="p-3 sm:p-4 rounded-full bg-red-600 hover:bg-red-700 transition"
                                            >
                                                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M5 3a2 2 0 00-2 2v1c0 8.284 6.716 15 15 15h1a2 2 0 002-2v-3.28a1 1 0 00-.684-.948l-4.493-1.498a1 1 0 00-1.21.502l-1.13 2.257a11.042 11.042 0 01-5.516-5.517l2.257-1.128a1 1 0 00.502-1.21L9.228 3.683A1 1 0 008.279 3H5z" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                `}
                            </div>

                            <!-- Active Users -->
                            <div class="bg-white rounded-2xl shadow-lg p-5 slide-in">
                                <h2 class="font-bold text-base sm:text-lg mb-4 flex items-center gap-2 text-gray-800">
                                    <div class="bg-green-100 p-2 rounded-lg">
                                        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                                        </svg>
                                    </div>
                                    <span>Active Now</span>
                                    <span class="ml-auto bg-green-100 text-green-700 text-sm font-bold px-3 py-1 rounded-full">${state.activeUsers.length}</span>
                                </h2>
                                <div class="space-y-2">
                                    ${state.activeUsers.length > 0 ? state.activeUsers.map(user => `
                                        <div class="flex items-center gap-3 p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl border border-green-100">
                                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse shadow-lg"></div>
                                            <span class="text-sm font-semibold text-gray-800">${user.name}</span>
                                        </div>
                                    `).join('') : `
                                        <p class="text-gray-500 text-sm text-center py-4">No one is online right now</p>
                                    `}
                                </div>
                            </div>

                            <!-- Admin Panel -->
                            ${state.currentUser?.role === 'admin' && state.pendingUsers.length > 0 ? `
                                <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-2xl shadow-lg p-5 border-2 border-orange-200 slide-in">
                                    <h2 class="font-bold text-base sm:text-lg mb-4 flex items-center gap-2 text-gray-800">
                                        <div class="bg-orange-100 p-2 rounded-lg">
                                            <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                                            </svg>
                                        </div>
                                        <span>Approval Requests</span>
                                        <span class="ml-auto bg-orange-500 text-white text-sm font-bold px-3 py-1 rounded-full notification-badge">${state.pendingUsers.length}</span>
                                    </h2>
                                    <div class="space-y-3">
                                        ${state.pendingUsers.map(user => `
                                            <div class="bg-white border-2 border-orange-100 rounded-xl p-4 shadow-sm">
                                                <div class="flex items-start justify-between mb-3">
                                                    <div>
                                                        <p class="font-bold text-base text-gray-800">${user.name}</p>
                                                        <p class="text-xs text-gray-500 mt-1">${user.email}</p>
                                                    </div>
                                                </div>
                                                <div class="flex gap-2">
                                                    <button
                                                        onclick="approveUser('${user.email}')"
                                                        class="flex-1 bg-gradient-to-r from-green-600 to-emerald-600 text-white py-2.5 px-3 rounded-xl hover:from-green-700 hover:to-emerald-700 transition-all flex items-center justify-center gap-2 text-sm font-semibold shadow-md"
                                                    >
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                                        </svg>
                                                        Approve
                                                    </button>
                                                    <button
                                                        onclick="rejectUser('${user.email}')"
                                                        class="flex-1 bg-gradient-to-r from-red-600 to-pink-600 text-white py-2.5 px-3 rounded-xl hover:from-red-700 hover:to-pink-700 transition-all flex items-center justify-center gap-2 text-sm font-semibold shadow-md"
                                                    >
                                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                                        </svg>
                                                        Reject
                                                    </button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Family Members -->
                            <div class="bg-white rounded-2xl shadow-lg p-5 slide-in">
                                <h2 class="font-bold text-base sm:text-lg mb-4 flex items-center gap-2 text-gray-800">
                                    <div class="bg-purple-100 p-2 rounded-lg">
                                        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                                        </svg>
                                    </div>
                                    <span>Family Members</span>
                                    <span class="ml-auto bg-purple-100 text-purple-700 text-sm font-bold px-3 py-1 rounded-full">${state.approvedUsers.length}</span>
                                </h2>
                                <div class="space-y-2">
                                    ${state.approvedUsers.map(user => `
                                        <div class="flex items-center justify-between p-3 bg-gradient-to-r from-gray-50 to-purple-50 rounded-xl border border-purple-100 hover:border-purple-200 transition">
                                            <div class="flex items-center gap-3">
                                                <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full flex items-center justify-center text-white font-bold text-sm">
                                                    ${user.name.charAt(0).toUpperCase()}
                                                </div>
                                                <span class="text-sm font-semibold text-gray-800">${user.name}</span>
                                            </div>
                                            ${user.role === 'admin' ? '<span class="text-xs bg-gradient-to-r from-purple-600 to-blue-600 text-white px-3 py-1 rounded-full font-bold shadow-sm">Admin</span>' : ''}
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Re-attach video stream after render if still in call
            if (wasInCall && currentStream && state.inCall) {
                setTimeout(() => {
                    const video = document.getElementById('localVideo');
                    if (video && video.srcObject !== currentStream) {
                        video.srcObject = currentStream;
                    }
                }, 0);
            }
        }

        // Initialize
        loadData();
    </script>
</body>
</html>